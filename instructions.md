# Hedge Fund Portfolio Project - Story Points

1. **Project Setup and Repository Structure**  
   - [x] **Create the Project Folder Structure**  
     - [x] Inside the root, create the following subdirectories:
       - [x] `data/` – for storing market data files.
       - [x] `docs/` – for documentation and the final PDF report.
       - [x] `src/` – for all source code files.
       - [x] `tests/` – for unit tests and other testing resources.
   - [x] **Create Core Files and Artifacts**  
     - [x] In the `src/` folder, create:
       - [x] `__init__.py` (to make the folder a Python package).
       - [x] `config.py`
       - [x] `data_acquisition.py`
       - [x] `portfolio.py`
       - [x] `performance.py`
       - [x] `reporting.py`
       - [x] `main.py`
     - [x] Create `requirements.txt` in the root with the following dependencies:
       - [x] `pandas`
       - [x] `numpy`
       - [x] `yfinance`
       - [x] `statsmodels`
       - [x] `openpyxl`
       - [x] `reportlab` (or any alternative for PDF generation)
     - [x] Create a `README.md` file outlining project goals, setup instructions, and usage.

2. **Implement Configuration Module (`config.py`)**  
   - [x] **Define Portfolio Parameters and Global Variables**  
     - [x] Set the initial capital:
       - [x] `INITIAL_CAPITAL_USD = 10_000_000`
     - [x] Define portfolio exposure:
       - [x] `GROSS_EXPOSURE = 10_000_000`
   - [x] **Define Ticker Lists**  
     - [x] For long positions, add the following tickers:
       - [x] `LONG_TICKERS = ['AAPL', 'MSFT', 'AMZN', 'JNJ', 'WMT']`
     - [x] For short positions, add the following tickers:
       - [x] `SHORT_TICKERS = ['TSLA', 'META', 'SHOP', 'NVDA', 'BA']`
       - [x] Specify the market index ticker:
       - [x] `MARKET_INDEX = '^GSPC'`
   - [x] **Define Fee Parameters**  
     - [x] Set annual management fee:
       - [x] `MANAGEMENT_FEE_ANNUAL = 0.02`  (i.e., 2% per year)
     - [x] Set transaction fee per share:
       - [x] `TRANSACTION_FEE_PER_SHARE = 0.01`
   - [x] **Set the Analysis Period and Rebalancing Tolerance**  
     - [x] Define the month and year for simulation:
       - [x] `ANALYSIS_YEAR = 2025`
       - [x] `ANALYSIS_MONTH = 1`  (January)
     - [x] Set the beta tolerance threshold:
       - [x] `BETA_TOLERANCE = 0.05`

3. **Implement Data Acquisition Module (`data_acquisition.py`)**  
   - [x] **Import Required Libraries**  
     - [x] Import `yfinance` for data download.
     - [x] Import `pandas` for data manipulation.
   - [x] **Implement Date Range Calculation**  
     - [x] Create a function `get_date_range(year, month)` that:
       - [x] Accepts `year` and `month` as input.
       - [x] Calculates and returns the start and end dates for the given month (e.g., using `pandas.Period` or similar).
   - [x] **Download Market Data**  
     - [x] Create a function `download_market_data(tickers, start_date, end_date)` that:
       - [x] Uses `yfinance.download` to retrieve historical adjusted close prices for all given tickers.
       - [x] Returns a `DataFrame` with the prices indexed by date.
       - [x] Handles missing data (filtering out non-trading days).
   - [x] **Implement Exchange Rate Data Retrieval**  
     - [x] Either:
       - [x] Download USD/CAD exchange rate data via an API or CSV.
       - [x] OR simulate a constant rate for testing purposes.
     - [x] Ensure exchange rates are stored in a time-indexed structure (e.g., a `Series`).
   - [x] **Data Validation and Cleaning**  
     - [x] Ensure all tickers have data for the entire period.
     - [x] Align all datasets by date.

4. **Implement Portfolio Module (`portfolio.py`)**  
   - [x] **Import Required Libraries**  
     - [x] Import `numpy`, `pandas`, and `statsmodels.api` for regression analysis.
   - [x] **Implement Beta Calculation for Individual Stocks**  
     - [x] Create function `compute_beta(stock_returns, market_returns)` that:
       - [x] Accepts two `Series`: one for stock returns and one for market returns.
       - [x] Uses OLS regression (via `statsmodels`) to compute beta.
       - [x] Returns the beta coefficient.
   - [x] **Implement Portfolio Beta Calculation**  
     - [x] Create function `compute_portfolio_beta(positions, betas)` that:
       - [x] Accepts a dictionary of positions (ticker: position value) and a dictionary of individual betas.
       - [x] Computes a weighted average beta (using absolute position exposures for normalization).
       - [x] Returns the aggregated portfolio beta.
   - [x] **Initialize the Portfolio**  
     - [x] Create function `initialize_portfolio(initial_capital, prices, tickers_long, tickers_short)` that:
       - [x] Splits the capital equally for long and short positions.
       - [x] Calculates dollar allocation per ticker for each group.
       - [x] Divides the allocated capital by the initial price of each ticker to get the number of shares.
       - [x] For short positions, assign a negative number of shares.
       - [x] Returns a dictionary mapping each ticker to its number of shares.
   - [x] **Implement Portfolio Rebalancing Logic**  
     - [x] Create function `rebalance_portfolio(current_portfolio, day_prices, betas)` that:
       - [x] Checks if the portfolio beta deviates beyond `BETA_TOLERANCE`.
       - [x] Recalculates the desired weights to achieve beta neutrality.
       - [x] Adjusts the number of shares for each ticker accordingly.
       - [x] Calculates and logs transaction fees based on `TRANSACTION_FEE_PER_SHARE`.
       - [x] Returns the updated portfolio along with any transaction cost details.

5. **Implement Performance Module (`performance.py`)**  
   - [x] **Import Required Libraries**  
     - [x] Import `pandas` and any additional libraries for calculations.
   - [x] **Calculate Daily Returns**  
     - [x] Implement logic to compute daily returns from the adjusted close prices:
       - [x] Ensure that returns are computed for every ticker.
       - [x] Handle any missing data points appropriately.
   - [x] **Simulate Daily Portfolio Performance**  
     - [x] Create function `simulate_portfolio(daily_prices, portfolio, betas, market_returns, exchange_rates)` that:
       - [x] Iterates over each trading day in the simulation period.
       - [x] For each day:
         - [x] Extract current prices from the `daily_prices` DataFrame.
         - [x] Calculate the current position value for each ticker (number of shares × current price).
         - [x] Sum the absolute position values to compute total portfolio exposure.
         - [x] Calculate the daily return of the portfolio.
         - [x] Compute the portfolio beta using `compute_portfolio_beta`.
         - [x] Check if the portfolio beta exceeds `BETA_TOLERANCE`:
           - [x] If yes, trigger rebalancing by calling `rebalance_portfolio` and record the event.
         - [x] Apply daily management fees:
           - [x] Calculate fee as `(MANAGEMENT_FEE_ANNUAL / 252) * portfolio_value`.
           - [x] Deduct the fee from the portfolio value.
         - [x] Convert the portfolio value from USD to CAD using the day's exchange rate.
         - [x] Log all details for the day (date, portfolio values in USD and CAD, daily return, beta, rebalancing flag).
       - [x] Return a DataFrame with daily simulation results.

6. **Implement Reporting Module (`reporting.py`)**  
   - [x] **Import Required Libraries**  
     - [x] Import `pandas` for data export.
     - [x] Import `reportlab` (or an alternative) for PDF generation.
     - [x] (Optionally) Import `jinja2` if using templated reports.
   - [x] **Generate the Monthly Investor Letter (PDF Report)**  
     - [x] Create a function `generate_monthly_report(daily_results, portfolio, beta_dict)` that:
       - [x] Compiles a summary including:
         - [x] Introduction to the strategy.
         - [x] Justification of the selected long and short tickers.
         - [x] Summary of monthly performance in both USD and CAD.
         - [x] Evolution of portfolio beta (initial, daily changes, final beta).
         - [x] Details and rationale for any rebalancing events.
         - [x] Conclusion and outlook.
       - [x] Formats the report (using plain text, HTML, or a template).
       - [x] Converts the formatted report into a PDF file.
   - [x] **Export Detailed Performance Data to Excel**  
     - [x] Create a function `export_to_excel(daily_df, filename='portfolio_performance.xlsx')` that:
       - [x] Uses `pandas.ExcelWriter` to write:
         - [x] Daily performance data (date, USD/CAD values, beta, etc.) on one sheet.
         - [x] Additional sheets for rebalancing logs and beta calculations, if desired.
       - [x] Saves the Excel file with the given filename.

7. **Implement Main Application Logic (`main.py`)**  
   - [x] **Integrate All Modules**  
     - [x] Import configuration from `config.py`.
     - [x] Import functions from `data_acquisition.py`, `portfolio.py`, `performance.py`, and `reporting.py`.
   - [x] **Main Execution Workflow**  
     - [x] Retrieve the analysis period by calling `get_date_range(ANALYSIS_YEAR, ANALYSIS_MONTH)`.
     - [x] Download market data for:
       - [x] All tickers in `LONG_TICKERS`, `SHORT_TICKERS`, and the `MARKET_INDEX`.
     - [x] Retrieve or simulate USD/CAD exchange rates.
     - [x] Initialize the portfolio:
       - [x] Use the first available day's prices to compute the number of shares for each ticker via `initialize_portfolio`.
     - [x] Compute initial betas for each ticker:
       - [x] Calculate returns for each ticker and the market index.
       - [x] Use `compute_beta` to estimate betas.
     - [x] Run the daily simulation by calling `simulate_portfolio` with all required parameters.
     - [x] Generate the monthly report:
       - [x] Call `generate_monthly_report` with the simulation results.
     - [x] Export detailed performance data to an Excel file:
       - [x] Call `export_to_excel`.
   - [x] **Error Handling and Logging**  
     - [x] Integrate Python's `logging` module to record events, errors, and rebalancing triggers.
     - [x] Use try/except blocks where necessary (e.g., during data downloads or calculations).
   - [x] **Unit Tests for Main Application Functions**  
     - [x] In `tests/test_main.py`, add tests that simulate parts of the main workflow using mocks or sample data.
   - [x] **Integration Tests for the Full Application**  
     - [x] Create an integration test (e.g., in `tests/integration/test_full_flow.py`) that:
       - [x] Executes `main.py` end-to-end (with a limited dataset for speed).
       - [x] Verifies that all modules interact correctly and that final outputs (PDF, Excel, logs) are generated.

8. **Documentation, Testing, and Quality Assurance**  
   - [x] **Documentation**  
     - [x] Add comprehensive docstrings to every function and module.
     - [x] Comment key parts of the code to explain the logic behind beta calculations, rebalancing, fees, etc.
     - [x] Update `README.md` with:
       - [x] Project overview.
       - [x] Installation instructions.
       - [x] Usage guidelines.
       - [x] Instructions on how to change the analysis period and other parameters.
   - [x] **Unit Testing at Each Step**  
     - [x] Ensure that each module has its corresponding test file in the `tests/` folder.
     - [x] Run the unit tests to catch and fix any errors.
   - [x] **Integration Testing**  
     - [x] Run the integration tests to verify that different modules work together as expected.
     - [x] Document the testing procedures in the `README.md` or a dedicated testing documentation file.
   - [x] **Code Quality**  
     - [x] Ensure adherence to PEP 8 style guidelines.
     - [x] Run static analysis tools (like `flake8` or `pylint`) to verify code quality.

9. **Final Integration and Validation**  
   - [ ] **Run the Full Simulation**  
     - [ ] Execute the complete program for the analysis period (January 2025).
     - [ ] Validate that the simulation runs without errors.
   - [ ] **Verify Outputs**  
     - [ ] Confirm that the daily simulation DataFrame contains correct values (USD/CAD portfolio values, beta, flags).
     - [ ] Check that the PDF report (monthly investor letter) is generated and includes:
       - [ ] Strategy justification.
       - [ ] Performance summary.
       - [ ] Beta evolution and rebalancing details.
     - [ ] Verify that the Excel file is created with multiple sheets (daily performance, rebalancing logs, beta calculations).
   - [ ] **Review Logging and Error Handling**  
     - [ ] Inspect log files (or console output) for any errors or warnings during the simulation.