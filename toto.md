Below is an updated and very detailed markdown numbered list of story point tasks. In addition to the previous implementation steps, integration tests and unit tests at each step have been explicitly included to ensure that each module and the entire system work as intended.

---

# Hedge Fund Portfolio Project - Detailed Story Points with Testing

1. **Project Setup and Repository Structure**  
   - [ ] **Create the Project Folder Structure**  
     - [ ] Create a root directory named `hedge_fund_portfolio`.
     - [ ] Inside the root, create the following subdirectories:
       - [ ] `data/` – for storing market data files.
       - [ ] `docs/` – for documentation and the final PDF report.
       - [ ] `src/` – for all source code files.
       - [ ] `tests/` – for unit tests and integration tests.
   - [ ] **Create Core Files and Artifacts**  
     - [ ] In the `src/` folder, create:
       - [ ] `__init__.py` (to make the folder a Python package).
       - [ ] `config.py`
       - [ ] `data_acquisition.py`
       - [ ] `portfolio.py`
       - [ ] `performance.py`
       - [ ] `reporting.py`
       - [ ] `main.py`
     - [ ] Create `requirements.txt` in the root with the following dependencies:
       - [ ] `pandas`
       - [ ] `numpy`
       - [ ] `yfinance`
       - [ ] `statsmodels`
       - [ ] `openpyxl`
       - [ ] `reportlab` (or an alternative for PDF generation)
     - [ ] Create a `README.md` file outlining project goals, setup instructions, and usage.

2. **Implement Configuration Module (`config.py`)**  
   - [ ] **Define Portfolio Parameters and Global Variables**  
     - [ ] Set the initial capital:
       - [ ] `INITIAL_CAPITAL_USD = 10_000_000`
     - [ ] Define portfolio exposure:
       - [ ] `GROSS_EXPOSURE = 10_000_000`
   - [ ] **Define Ticker Lists**  
     - [ ] For long positions, add (example tickers):
       - [ ] `LONG_TICKERS = ['AAPL', 'MSFT', 'GOOGL', 'AMZN', 'NVDA']`
     - [ ] For short positions, add (example tickers):
       - [ ] `SHORT_TICKERS = ['IBM', 'INTC', 'CSCO', 'ORCL', 'HPQ']`
     - [ ] Specify the market index ticker:
       - [ ] `MARKET_INDEX = '^GSPC'`
   - [ ] **Define Fee Parameters**  
     - [ ] Set annual management fee:
       - [ ] `MANAGEMENT_FEE_ANNUAL = 0.02`  (i.e., 2% per year)
     - [ ] Set transaction fee per share:
       - [ ] `TRANSACTION_FEE_PER_SHARE = 0.01`
   - [ ] **Set the Analysis Period and Rebalancing Tolerance**  
     - [ ] Define the month and year for simulation:
       - [ ] `ANALYSIS_YEAR = 2025`
       - [ ] `ANALYSIS_MONTH = 2`  (February)
     - [ ] Set the beta tolerance threshold:
       - [ ] `BETA_TOLERANCE = 0.05`
   - [ ] **Create Unit Tests for `config.py`**  
     - [ ] In the `tests/` directory, add a file (e.g., `test_config.py`) that:
       - [ ] Verifies all constants (e.g., `INITIAL_CAPITAL_USD`, ticker lists) are correctly defined.
       - [ ] Checks for type and value correctness.

3. **Implement Data Acquisition Module (`data_acquisition.py`)**  
   - [ ] **Import Required Libraries**  
     - [ ] Import `yfinance` for data download.
     - [ ] Import `pandas` for data manipulation.
   - [ ] **Implement Date Range Calculation**  
     - [ ] Create a function `get_date_range(year, month)` that:
       - [ ] Accepts `year` and `month` as input.
       - [ ] Calculates and returns the start and end dates for the given month (e.g., using `pandas.Period` or similar).
   - [ ] **Download Market Data**  
     - [ ] Create a function `download_market_data(tickers, start_date, end_date)` that:
       - [ ] Uses `yfinance.download` to retrieve historical adjusted close prices for all given tickers.
       - [ ] Returns a `DataFrame` with the prices indexed by date.
       - [ ] Handles missing data (filtering out non-trading days).
   - [ ] **Implement Exchange Rate Data Retrieval**  
     - [ ] Either:
       - [ ] Download USD/CAD exchange rate data via an API or CSV.
       - [ ] OR simulate a constant rate for testing purposes.
     - [ ] Ensure exchange rates are stored in a time-indexed structure (e.g., a `pandas.Series`).
   - [ ] **Data Validation and Cleaning**  
     - [ ] Ensure all tickers have data for the entire period.
     - [ ] Align all datasets by date.
   - [ ] **Unit Tests for Data Acquisition Module**  
     - [ ] Create tests in `tests/test_data_acquisition.py` to:
       - [ ] Verify that `get_date_range()` returns valid start and end dates.
       - [ ] Ensure `download_market_data()` returns a non-empty DataFrame with expected columns.
       - [ ] Validate exchange rate data integrity.
   - [ ] **Integration Tests for Data Acquisition**  
     - [ ] Write an integration test (e.g., in `tests/integration/test_data_flow.py`) that:
       - [ ] Calls `get_date_range()` and then `download_market_data()` for a small date range.
       - [ ] Checks that the returned data aligns with expected trading dates.

4. **Implement Portfolio Module (`portfolio.py`)**  
   - [ ] **Import Required Libraries**  
     - [ ] Import `numpy`, `pandas`, and `statsmodels.api` for regression analysis.
   - [ ] **Implement Beta Calculation for Individual Stocks**  
     - [ ] Create function `compute_beta(stock_returns, market_returns)` that:
       - [ ] Accepts two `pandas.Series`: one for stock returns and one for market returns.
       - [ ] Uses OLS regression (via `statsmodels`) to compute beta.
       - [ ] Returns the beta coefficient.
   - [ ] **Implement Portfolio Beta Calculation**  
     - [ ] Create function `compute_portfolio_beta(positions, betas)` that:
       - [ ] Accepts a dictionary of positions (ticker: position value) and a dictionary of individual betas.
       - [ ] Computes a weighted average beta (using absolute position exposures for normalization).
       - [ ] Returns the aggregated portfolio beta.
   - [ ] **Initialize the Portfolio**  
     - [ ] Create function `initialize_portfolio(initial_capital, prices, tickers_long, tickers_short)` that:
       - [ ] Splits the capital equally for long and short positions.
       - [ ] Calculates dollar allocation per ticker for each group.
       - [ ] Divides the allocated capital by the initial price of each ticker to get the number of shares.
       - [ ] For short positions, assign a negative number of shares.
       - [ ] Returns a dictionary mapping each ticker to its number of shares.
   - [ ] **Implement Portfolio Rebalancing Logic**  
     - [ ] Create function `rebalance_portfolio(current_portfolio, day_prices, betas)` that:
       - [ ] Checks if the portfolio beta deviates beyond `BETA_TOLERANCE`.
       - [ ] Recalculates the desired weights to achieve beta neutrality.
       - [ ] Adjusts the number of shares for each ticker accordingly.
       - [ ] Calculates and logs transaction fees based on `TRANSACTION_FEE_PER_SHARE`.
       - [ ] Returns the updated portfolio along with any transaction cost details.
   - [ ] **Unit Tests for Portfolio Module**  
     - [ ] In `tests/test_portfolio.py`, add tests to verify:
       - [ ] `compute_beta()` returns a reasonable value using sample data.
       - [ ] `compute_portfolio_beta()` correctly computes the weighted beta.
       - [ ] `initialize_portfolio()` produces a dictionary with proper share counts for long and short tickers.
       - [ ] `rebalance_portfolio()` adjusts positions correctly and returns updated portfolio details.
   - [ ] **Integration Tests for Portfolio Module**  
     - [ ] Create integration tests (e.g., in `tests/integration/test_portfolio_flow.py`) that:
       - [ ] Initialize a sample portfolio.
       - [ ] Simulate a change in market conditions (by providing altered `day_prices`).
       - [ ] Trigger rebalancing and verify that the resulting portfolio beta is within the `BETA_TOLERANCE`.

5. **Implement Performance Module (`performance.py`)**  
   - [ ] **Import Required Libraries**  
     - [ ] Import `pandas` and any additional libraries for calculations.
   - [ ] **Calculate Daily Returns**  
     - [ ] Implement logic to compute daily returns from the adjusted close prices:
       - [ ] Ensure that returns are computed for every ticker.
       - [ ] Handle any missing data points appropriately.
   - [ ] **Simulate Daily Portfolio Performance**  
     - [ ] Create function `simulate_portfolio(daily_prices, portfolio, betas, market_returns, exchange_rates)` that:
       - [ ] Iterates over each trading day in the simulation period.
       - [ ] For each day:
         - [ ] Extract current prices from the `daily_prices` DataFrame.
         - [ ] Calculate the current position value for each ticker (number of shares × current price).
         - [ ] Sum the absolute position values to compute total portfolio exposure.
         - [ ] Calculate the daily return of the portfolio.
         - [ ] Compute the portfolio beta using `compute_portfolio_beta`.
         - [ ] Check if the portfolio beta exceeds `BETA_TOLERANCE`:
           - [ ] If yes, trigger rebalancing by calling `rebalance_portfolio` and record the event.
         - [ ] Apply daily management fees:
           - [ ] Calculate fee as `(MANAGEMENT_FEE_ANNUAL / 252) * portfolio_value`.
           - [ ] Deduct the fee from the portfolio value.
         - [ ] Convert the portfolio value from USD to CAD using the day's exchange rate.
         - [ ] Log all details for the day (date, portfolio values in USD and CAD, daily return, beta, rebalancing flag).
       - [ ] Return a DataFrame with daily simulation results.
   - [ ] **Unit Tests for Performance Module**  
     - [ ] In `tests/test_performance.py`, add tests to:
       - [ ] Verify the correct calculation of daily returns given sample price data.
       - [ ] Ensure that the portfolio performance simulation returns a DataFrame with the required columns.
       - [ ] Test fee deductions and currency conversion on sample inputs.
   - [ ] **Integration Tests for Performance Flow**  
     - [ ] Create an integration test (e.g., in `tests/integration/test_performance_flow.py`) that:
       - [ ] Runs `simulate_portfolio` using a subset of sample data.
       - [ ] Verifies that daily performance outputs (portfolio value, beta, rebalancing flag) are consistent with expected behavior.

6. **Implement Reporting Module (`reporting.py`)**  
   - [ ] **Import Required Libraries**  
     - [ ] Import `pandas` for data export.
     - [ ] Import `reportlab` (or an alternative) for PDF generation.
     - [ ] (Optionally) Import `jinja2` if using templated reports.
   - [ ] **Generate the Monthly Investor Letter (PDF Report)**  
     - [ ] Create a function `generate_monthly_report(daily_results, portfolio, beta_dict)` that:
       - [ ] Compiles a summary including:
         - [ ] Introduction to the strategy.
         - [ ] Justification of the selected long and short tickers.
         - [ ] Summary of monthly performance in both USD and CAD.
         - [ ] Evolution of portfolio beta (initial, daily changes, final beta).
         - [ ] Details and rationale for any rebalancing events.
         - [ ] Conclusion and outlook.
       - [ ] Formats the report (using plain text, HTML, or a template).
       - [ ] Converts the formatted report into a PDF file.
   - [ ] **Export Detailed Performance Data to Excel**  
     - [ ] Create a function `export_to_excel(daily_df, filename='portfolio_performance.xlsx')` that:
       - [ ] Uses `pandas.ExcelWriter` to write:
         - [ ] Daily performance data (date, USD/CAD values, beta, etc.) on one sheet.
         - [ ] Additional sheets for rebalancing logs and beta calculations, if desired.
       - [ ] Saves the Excel file with the given filename.
   - [ ] **Unit Tests for Reporting Module**  
     - [ ] In `tests/test_reporting.py`, write tests to:
       - [ ] Verify that `generate_monthly_report` produces a non-empty PDF file (or valid report content).
       - [ ] Test that `export_to_excel` creates an Excel file with the expected sheet names and data.
   - [ ] **Integration Tests for Reporting**  
     - [ ] Develop an integration test (e.g., in `tests/integration/test_reporting_flow.py`) that:
       - [ ] Runs the full reporting workflow on sample simulation data.
       - [ ] Checks that both the PDF and Excel files are generated and saved correctly.

7. **Implement Main Application Logic (`main.py`)**  
   - [ ] **Integrate All Modules**  
     - [ ] Import configuration from `config.py`.
     - [ ] Import functions from `data_acquisition.py`, `portfolio.py`, `performance.py`, and `reporting.py`.
   - [ ] **Main Execution Workflow**  
     - [ ] Retrieve the analysis period by calling `get_date_range(ANALYSIS_YEAR, ANALYSIS_MONTH)`.
     - [ ] Download market data for:
       - [ ] All tickers in `LONG_TICKERS`, `SHORT_TICKERS`, and the `MARKET_INDEX`.
     - [ ] Retrieve or simulate USD/CAD exchange rates.
     - [ ] Initialize the portfolio:
       - [ ] Use the first available day’s prices to compute the number of shares for each ticker via `initialize_portfolio`.
     - [ ] Compute initial betas for each ticker:
       - [ ] Calculate returns for each ticker and the market index.
       - [ ] Use `compute_beta` to estimate betas.
     - [ ] Run the daily simulation by calling `simulate_portfolio` with all required parameters.
     - [ ] Generate the monthly report:
       - [ ] Call `generate_monthly_report` with the simulation results.
     - [ ] Export detailed performance data to an Excel file:
       - [ ] Call `export_to_excel`.
   - [ ] **Error Handling and Logging**  
     - [ ] Integrate Python’s `logging` module to record events, errors, and rebalancing triggers.
     - [ ] Use try/except blocks where necessary (e.g., during data downloads or calculations).
   - [ ] **Unit Tests for Main Application Functions**  
     - [ ] In `tests/test_main.py`, add tests that simulate parts of the main workflow using mocks or sample data.
   - [ ] **Integration Tests for the Full Application**  
     - [ ] Create an integration test (e.g., in `tests/integration/test_full_flow.py`) that:
       - [ ] Executes `main.py` end-to-end (with a limited dataset for speed).
       - [ ] Verifies that all modules interact correctly and that final outputs (PDF, Excel, logs) are generated.

8. **Documentation, Testing, and Quality Assurance**  
   - [ ] **Documentation**  
     - [ ] Add comprehensive docstrings to every function and module.
     - [ ] Comment key parts of the code to explain the logic behind beta calculations, rebalancing, fees, etc.
     - [ ] Update `README.md` with:
       - [ ] Project overview.
       - [ ] Installation instructions.
       - [ ] Usage guidelines.
       - [ ] Instructions on how to change the analysis period and other parameters.
   - [ ] **Unit Testing at Each Step**  
     - [ ] Ensure that each module has its corresponding test file in the `tests/` folder.
     - [ ] Run unit tests frequently during development to catch errors early.
   - [ ] **Integration Testing**  
     - [ ] Develop and run integration tests to verify that different modules work together as expected.
     - [ ] Document the testing procedures in the `README.md` or a dedicated testing documentation file.
   - [ ] **Code Quality**  
     - [ ] Ensure adherence to PEP 8 style guidelines.
     - [ ] Run static analysis tools (like `flake8` or `pylint`) to verify code quality.
     - [ ] Integrate a Continuous Integration (CI) pipeline (e.g., GitHub Actions) to run tests on every commit.

9. **Final Integration and Validation**  
   - [ ] **Run the Full Simulation**  
     - [ ] Execute the complete program for the analysis period (February 2025).
     - [ ] Validate that the simulation runs without errors.
   - [ ] **Verify Outputs**  
     - [ ] Confirm that the daily simulation DataFrame contains correct values (USD/CAD portfolio values, beta, flags).
     - [ ] Check that the PDF report (monthly investor letter) is generated and includes:
       - [ ] Strategy justification.
       - [ ] Performance summary.
       - [ ] Beta evolution and rebalancing details.
     - [ ] Verify that the Excel file is created with multiple sheets (daily performance, rebalancing logs, beta calculations).
   - [ ] **Review Logging and Error Handling**  
     - [ ] Inspect log files (or console output) for any errors or warnings during the simulation.

10. **Submission and Delivery**  
    - [ ] **Prepare the Final Deliverables**  
      - [ ] Ensure the PDF report is finalized and formatted correctly.
      - [ ] Confirm that the Excel file with detailed performance analysis is accurate and complete.
    - [ ] **Email Submission**  
      - [ ] By January 31, 2025, send an email to `Jonathan.plante@hec.ca` with:
        - [ ] The names of the teams and all participants.
        - [ ] The long and short tickers that comprise the portfolio.
      - [ ] Before March 14, 2025, email:
        - [ ] The final PDF report (monthly investor letter).
        - [ ] The Excel file with all analysis details.
    - [ ] **Final Checks**  
      - [ ] Verify that no submission deadlines are missed.
      - [ ] Double-check that all requirements (e.g., fee calculations, exchange rate conversion, beta reporting) are documented in the report.
      - [ ] Ensure that both unit and integration tests pass in the CI pipeline.

---

By following this detailed checklist—with integration tests and unit tests clearly defined at each step—you will ensure that the full system is robust, well-documented, and correctly implements the hedge fund portfolio strategy along with comprehensive reporting.